(function(u,s,M,v){"use strict";const l=v.findByProps("sendMessage","sendBotMessage"),w=476,p=42;let h=[];async function y(t,n){t.set("pid",n.toString());const e=await fetch("https://gelbooru.com/index.php?"+t).then(function(a){return a.json()});return e["@attributes"].count?{info:e,posts:e["@attributes"].count}:{info:null,posts:null}}function d(t,n){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!t)return e;for(const a of t)if(a.name==n)return a.value;return e}var $={onLoad:function(){h.push(M.registerCommand({name:"booru",displayName:"booru",description:"Search images from booru",displayDescription:"Search images from booru",applicationId:"-1",inputType:1,type:1,options:[{name:"tags",displayName:"tags",description:"Tags or criteria (space is a separator between tags)",displayDescription:"Tags or criteria (space is a separator between tags)",required:!1,type:3},{name:"rating",displayName:"rating",description:"Rating of images",displayDescription:"Rating of images",required:!1,type:3,choices:[{name:"General",displayName:"General",value:"general"},{name:"Sensitive",displayName:"Sensitive",value:"sensitive"},{name:"Questionable",displayName:"Questionable",value:"questionable"},{name:"Explicit",displayName:"Explicit",value:"explicit"}]},{name:"count",displayName:"count",description:"How many images to send (max 5)",displayDescription:"How many images to send (max 5)",required:!1,type:4}],execute:async function(t,n){try{let e=d(t,"tags","").trim();const a=d(t,"rating",""),o=d(t,"count",1);if(a&&(e=e+` rating:${a}`),o>5||o<1)return void l.sendBotMessage(n.channel.id,"Invalid `count` argument.");s.logger.log(`Tags and Rating: ${e}`),s.logger.log(`Count: ${o}`);const m=new URLSearchParams({page:"dapi",s:"post",q:"index",json:"1",limit:p.toString()});e&&m.set("tags",e);let g=await y(m,0);if(!g.posts)return void l.sendBotMessage(n.channel.id,"No results found.");s.logger.log(`Pages: ${g.posts/p}
Posts count: ${g.posts}`);let c=Math.trunc(g.posts/p);c=Math.floor(Math.random()*Math.min(c,w)),s.logger.log(`Selected page: ${c}`);const{info:i}=await y(m,c);let f,b=[];if(i.post.length<=o)f=i.post,s.logger.log(`The whole page has been selected (${i.post.length})`);else{const r=Math.max(Math.floor(Math.random()*i.post.length-o),0);f=i.post.slice(r,r+o),s.logger.log(`Random Post Number: ${r} - ${r+o}
Posts in the page: ${i.post.length}`)}for(let r of f)b.push(r.file_url);l.sendMessage(n.channel.id,{content:b.join(`
`)})}catch(e){l.sendBotMessage(n.channel.id,`Something went wrong: \`${e}\``)}}}))},onUnload:function(){for(const t of h)t()}};return u.default=$,Object.defineProperty(u,"__esModule",{value:!0}),u})({},vendetta,vendetta.commands,vendetta.metro);
